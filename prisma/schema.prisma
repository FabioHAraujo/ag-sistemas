// This is your Prisma schema file

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  MEMBER
}

enum UserStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
}

enum ApplicationStatus {
  PENDING
  APPROVED
  REJECTED
}

model User {
  id           String     @id @default(uuid())
  email        String     @unique
  passwordHash String     @map("password_hash")
  name         String
  role         Role       @default(MEMBER)
  status       UserStatus @default(ACTIVE)
  createdAt    DateTime   @default(now()) @map("created_at")
  updatedAt    DateTime   @updatedAt @map("updated_at")

  profile              MemberProfile?
  reviewedApplications Application[]  @relation("ApplicationReviewer")

  @@index([email])
  @@index([role])
  @@map("users")
}

model Application {
  id             String            @id @default(uuid())
  name           String
  email          String
  company        String
  motivation     String
  status         ApplicationStatus @default(PENDING)
  reviewedBy     String?           @map("reviewed_by")
  reviewedAt     DateTime?         @map("reviewed_at")
  token          String?           @unique
  tokenExpiresAt DateTime?         @map("token_expires_at")
  createdAt      DateTime          @default(now()) @map("created_at")
  updatedAt      DateTime          @updatedAt @map("updated_at")

  reviewer User?          @relation("ApplicationReviewer", fields: [reviewedBy], references: [id])
  profile  MemberProfile?

  @@index([status])
  @@index([email])
  @@map("applications")
}

model MemberProfile {
  id                 String    @id @default(uuid())
  userId             String    @unique @map("user_id")
  applicationId      String?   @unique @map("application_id")
  phone              String?
  company            String
  position           String?
  companyDescription String?   @map("company_description")
  expertiseArea      String?   @map("expertise_area")
  linkedinUrl        String?   @map("linkedin_url")
  websiteUrl         String?   @map("website_url")
  profileImageUrl    String?   @map("profile_image_url")
  bio                String?
  joinedAt           DateTime  @default(now()) @map("joined_at")
  createdAt          DateTime  @default(now()) @map("created_at")
  updatedAt          DateTime  @updatedAt @map("updated_at")

  user        User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  application Application? @relation(fields: [applicationId], references: [id])

  @@map("member_profiles")
}
